<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
  <h1 style="font-size: 2em; margin-bottom: 20px;">Agent Tracker Dashboard</h1>

  <nav style="margin-bottom: 30px; padding: 10px; background: #f5f5f5; border-radius: 5px;">
    <%= link_to "Dashboard", root_path, style: "margin-right: 15px;" %> |
    <%= link_to "Agents", agents_path, style: "margin: 0 15px;" %> |
    <%= link_to "Invocations", agent_invocations_path, style: "margin: 0 15px;" %> |
    <%= link_to "Quick Log", quick_log_path, style: "margin-left: 15px; font-weight: bold; color: green;" %>
  </nav>

  <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 8px; margin-bottom: 30px;">
    <h3 style="margin: 0 0 10px 0; color: #856404;">ðŸš€ Live Apps</h3>
    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
      <%= link_to "agent_tracker", "http://24.199.71.69/agent_tracker", target: "_blank", style: "padding: 8px 15px; background: #28a745; color: white; border-radius: 5px; text-decoration: none;" %>
      <%= link_to "Chromatic (Game)", "http://24.199.71.69/chromatic", target: "_blank", style: "padding: 8px 15px; background: #007bff; color: white; border-radius: 5px; text-decoration: none;" %>
      <%= link_to "Shopify Stockout Calc", "http://24.199.71.69/shopify_stockout_calc", target: "_blank", style: "padding: 8px 15px; background: #17a2b8; color: white; border-radius: 5px; text-decoration: none;" %>
      <%= link_to "idea_tracker", "http://24.199.71.69/idea_tracker", target: "_blank", style: "padding: 8px 15px; background: #6c757d; color: white; border-radius: 5px; text-decoration: none;" %>
    </div>
  </div>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div style="background: #e3f2fd; padding: 20px; border-radius: 8px;">
      <div style="font-size: 2em; font-weight: bold; color: #1976d2;"><%= @total_agents %></div>
      <div>Total Agents (<%= @active_agents %> active)</div>
    </div>

    <div style="background: #e8f5e9; padding: 20px; border-radius: 8px;">
      <div style="font-size: 2em; font-weight: bold; color: #388e3c;"><%= @total_invocations %></div>
      <div>Total Invocations</div>
      <div style="font-size: 0.9em;">Success: <%= @success_rate %>%</div>
    </div>

    <div style="background: #f3e5f5; padding: 20px; border-radius: 8px;">
      <div style="font-size: 2em; font-weight: bold; color: #7b1fa2;"><%= @average_satisfaction || "â€”" %></div>
      <div>Avg Satisfaction</div>
    </div>

    <div style="background: #ffebee; padding: 20px; border-radius: 8px;">
      <div style="font-size: 2em; font-weight: bold; color: #c62828;"><%= @open_issues_count %></div>
      <div>Open Issues</div>
    </div>
  </div>

  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
    <div style="background: white; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
      <h2 style="margin-bottom: 15px;">Most Used Agents</h2>
      <% @most_used_agents.each do |agent| %>
        <div style="margin-bottom: 10px;">
          <%= link_to agent.name, agent_path(agent) %> (<%= agent.invocations_count %>)
        </div>
      <% end %>
    </div>

    <div style="background: white; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
      <h2 style="margin-bottom: 15px;">Recent Invocations</h2>
      <% @recent_invocations.each do |inv| %>
        <div style="margin-bottom: 10px; font-size: 0.9em;">
          <%= link_to inv.agent.name, agent_invocation_path(inv) %> -
          <%= inv.started_at.strftime("%b %d, %H:%M") %> -
          <span style="color: <%= inv.success ? 'green' : 'red' %>"><%= inv.success_label %></span>
        </div>
      <% end %>
      <div style="margin-top: 15px;"><%= link_to "View all â†’", agent_invocations_path %></div>
    </div>
  </div>

  <div style="background: white; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
    <h2 style="margin-bottom: 15px;">Agents by Category</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
      <% @agents_by_category.sort_by { |k,v| -v }.first(8).each do |category, count| %>
        <div style="text-align: center; padding: 15px; background: #f5f5f5; border-radius: 5px;">
          <div style="font-size: 1.5em; font-weight: bold;"><%= count %></div>
          <div style="font-size: 0.9em;"><%= category.humanize %></div>
        </div>
      <% end %>
    </div>
  </div>
</div>
